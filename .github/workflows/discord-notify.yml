name: Discord Notification

on:
  push:
    branches: [master, dev]
  pull_request:
    types: [opened, reopened, closed]
  release:
    types: [published]
  issues:
    types: [opened]
  issue_comment:
    types: [created]

jobs:
  notify-discord:
    runs-on: ubuntu-latest

    steps:
      - name: Send Discord embed message
        uses: tsickert/discord-webhook@v7
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK }}
          username: GitHub Notifier
          avatar-url: https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png

          embeds: |
            ${{
              github.event_name == 'push' && toJson([
                {
                  "title": "üì¶ New Push to `" + github.ref_name + "`",
                  "description": github.event.head_commit.message,
                  "url": github.event.head_commit.url,
                  "color": 5814783,
                  "fields": [
                    {
                      "name": "Author",
                      "value": github.actor,
                      "inline": true
                    },
                    {
                      "name": "Repository",
                      "value": github.repository,
                      "inline": true
                    }
                  ]
                }
              ])
            }}

            ${{
              github.event_name == 'pull_request' && toJson([
                {
                  "title": "üîÉ Pull Request " + github.event.action + " #" + github.event.pull_request.number,
                  "description": github.event.pull_request.title,
                  "url": github.event.pull_request.html_url,
                  "color": 3447003,
                  "fields": [
                    {
                      "name": "Base Branch",
                      "value": github.event.pull_request.base.ref,
                      "inline": true
                    },
                    {
                      "name": "Author",
                      "value": github.actor,
                      "inline": true
                    }
                  ]
                }
              ])
            }}

            ${{
              github.event_name == 'release' && toJson([
                {
                  "title": "üèÅ New Release: " + github.event.release.name,
                  "description": github.event.release.body,
                  "url": github.event.release.html_url,
                  "color": 15844367,
                  "fields": [
                    {
                      "name": "Published by",
                      "value": github.actor,
                      "inline": true
                    }
                  ]
                }
              ])
            }}

            ${{
              github.event_name == 'issues' && github.event.action == 'opened' && toJson([
                {
                  "title": "üìå New Issue Opened",
                  "description": github.event.issue.title,
                  "url": github.event.issue.html_url,
                  "color": 15105570,
                  "fields": [
                    {
                      "name": "Author",
                      "value": github.actor,
                      "inline": true
                    },
                    {
                      "name": "Repository",
                      "value": github.repository,
                      "inline": true
                    }
                  ]
                }
              ])
            }}

            ${{
              github.event_name == 'issue_comment' && github.event.action == 'created' && toJson([
                {
                  "title": "üí¨ New Comment on Issue #" + github.event.issue.number,
                  "description": github.event.comment.body,
                  "url": github.event.comment.html_url,
                  "color": 10181046,
                  "fields": [
                    {
                      "name": "Comment by",
                      "value": github.actor,
                      "inline": true
                    }
                  ]
                }
              ])
            }}